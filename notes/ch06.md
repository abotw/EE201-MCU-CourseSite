---
title: Ch06
layout: page
parent: Notes
---

# Chapter 6: Interrupts and Dynamic Seven-Segment Display
{:.no_toc}

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

## 6.1 Array Concepts and Applications

- **Definition:** An array is a collection of variables of the **same data type** 1. Its main role is to manage multiple data items using a single variable name 2.
- **Access:** Individual elements are accessed using an **index** or **subscript**, which typically starts counting from **0** 3.
- **Memory Storage:** Array elements are stored in **contiguous (continuous)** memory space 4.
- **Address Formula:** The address of any element can be quickly calculated: **Target Address = Array Base Address + (Element Size Ã— Index)** 5.
	- **Target Address = Array Base Address + (Element Size Ã— Index)**
- **Storage in Microcontrollers:**
    - Data stored in **RAM** is fast to read/write but **volatile** (lost when power is off) 6.
    - Data stored using the **`code`** keyword is placed in **FLASH/ROM** (program memory), which is **non-volatile** (data persists when power is off). This is typically used for fixed constants like look-up tables (e.g., Seven-Segment Display Codes) 7.
- **Assignment:** You **cannot** assign a value to the entire array at once, except during initial declaration. Arrays must be operated on **element-by-element** 8.

## 6.2 Usage of `if` and `switch` Statements

- **Purpose:** These are **selection statements** (or conditional statements) that execute code selectively based on whether a condition is true or false 9.
- **`if-else if`:** Used for **multi-choice** logic. The program checks conditions sequentially from top to bottom and executes the code block for the **first condition that is true**, then immediately exits the entire structure 10.
- **`switch` Statement:** A cleaner, more readable way to handle multiple branches than a long `if-else if` chain 11.
    - **`break` is crucial:** The `break` statement is necessary after each `case` block to prevent **"fall-through,"** where the program continues executing the statements in the next `case` block 12.

## 6.3 Dynamic Seven-Segment Display

- **Principle:** The goal is to display different digits on multiple seven-segment displays simultaneously. This is achieved by utilizing the **persistence of human vision** 13.
- **Method:** Each display is lit up **sequentially and rapidly**, one at a time 14.
- **Refresh Requirement:** To prevent noticeable flicker, the total time for a full scan cycle (refreshing all displays) must be **less than 10 milliseconds** 15. (This is a 100Hz refresh rate standard) 16.
    - _Calculation:_ **Total Scan Time = Single Display On-Time Ã— Number of Displays** 17.
- **Digital Decomposition:** To display a multi-digit number (e.g., 1234), you use the **modulo operator (`%`)** to get the least significant digit (e.g., `1234 % 10 = 4`) and the **division operator (`/`)** to shift the number for the next digit (e.g., `1234 / 10 = 123`) 18.

## 6.4 Seven-Segment Display Blanking (Eliminating Ghosting)

- **Problem ("Ghosting"):** Faint illumination on segments that should be off during the dynamic scan 19.
- **Cause:** A transient delay during the switching process. The previous display's segment data remains on the bus briefly while the bit selection (address) is changing to the next display, causing the wrong segment code to appear for a moment 20.
- **Solution (Blanking):** Temporarily turn off either the segment output or the display selection during the switch:
    1. **Blank Segment Data:** Set the port connected to the segments to an "off" state (e.g., `P0 = 0xFF;`) before the switch logic 21.
    2. **Blank Bit Selection:** Disable the display's bit select pins (e.g., `ENLED = 1;`) before changing the address, then re-enable them (`ENLED = 0;`) after 22.

## 6.5 Study of the Interrupt System

- **The Need for Interrupts:** Without interrupts, any time-consuming task (e.g., calculation) in the main program loop will delay the dynamic display refresh, causing inconsistent timing and visible **flicker** ("jitter") 23.
- **Definition:** An interrupt is a mechanism for the microcontroller to **pause its current execution** and attend to a more urgent event 24.
- **Application:** The high-frequency (e.g., every 1ms) display refresh logic is moved into the **Interrupt Service Routine (ISR)**. This ensures the display scan occurs on a precise, guaranteed schedule, regardless of the main program's activities 25.
- **Enabling Interrupts (8051 Example):**
    - The **General Interrupt Switch (EA)** bit in the Interrupt Enable (IE) register must be set to 1 26.
    - The specific interrupt enable bit (e.g., **ET0** for Timer 0) must also be set to 1 27.

---

## ðŸ“š Exam Points for Final Exam

Focus on definitions, core principles, and the application of C language constructs to the microcontroller hardware (7-segment display and timer/interrupts).

### Core Concepts and Definitions

- **Array:** Definition, characteristic of **contiguous memory** storage, and the concept of **access by index** 28.
- **Storage Modifiers (`code`):** Differentiate between RAM storage (volatile, modifiable) and `code` storage (non-volatile, fixed, for look-up tables) 29.
- **Selection Statements:** The function of `if`, `else if`, and the importance of the **`break`** statement in `switch` (to prevent fall-through) 30.
- **Persistence of Vision:** The principle used to make dynamic displays appear steady 31.
- **10ms Rule:** The hard requirement for total scan time to avoid flicker 32.
- **Ghosting:** Define the phenomenon and its root **cause** (bit select/segment data switching latency) 33.
- **Interrupt:** Define an interrupt and explain its primary function in a microcontroller system (timely response, solving jitter in dynamic display) 34.

### Calculation and Application Skills

- Be able to calculate a **memory address** given the base address, element size, and index 35.
- Be able to calculate the **total scan time** or the single display on-time given the number of displays and the 10ms rule 36.
- Know the C language operators used for **digital decomposition**: **Modulo (`%`)** and **Division (`/`)** 37.
- Know the **methods to eliminate ghosting** (P0 blanking or ENLED blanking) 38.
- Identify the **Interrupt Enable (IE) Register** and the necessary bits (EA, ET0) to enable a Timer 0 interrupt 39.
- Understand the purpose of placing the display refresh logic within the **Interrupt Service Routine (ISR)**, such as `void InterruptTimer0() interrupt 1` 40.
